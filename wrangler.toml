# XIV Dye Tools OAuth Worker
# Handles Discord OAuth flow and JWT issuance

name = "xivdyetools-oauth"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Development settings (for wrangler dev)
[dev]
port = 8788
local_protocol = "http"

# Production environment variables (default for deployment)
# This ensures `wrangler deploy` always deploys to production
[vars]
ENVIRONMENT = "production"
DISCORD_CLIENT_ID = "1447108133020369048"
FRONTEND_URL = "https://xivdyetools.projectgalatine.com"
WORKER_URL = "https://xivdyetools-oauth.ashejunius.workers.dev"
# JWT expiry in seconds (1 hour)
JWT_EXPIRY = "3600"

# Development environment (use: wrangler dev --env development)
[env.development]
name = "xivdyetools-oauth-dev"
vars = { ENVIRONMENT = "development", DISCORD_CLIENT_ID = "1447108133020369048", FRONTEND_URL = "http://localhost:5173", WORKER_URL = "http://localhost:8788", JWT_EXPIRY = "3600" }

# KV Namespace for token revocation blacklist
[[kv_namespaces]]
binding = "TOKEN_BLACKLIST"
id = "0d6f3be3b4704e91a83e6387b9769e45"  # Production KV namespace for token revocation

# Development KV namespace
[[env.development.kv_namespaces]]
binding = "TOKEN_BLACKLIST"
id = "891bbbe834ba4055a06b672b589094be"
preview_id = "3d9eafa9aac64f18a1e9c56b228b4b68"  # Development preview KV namespace for token revocation

# Secrets (set via `wrangler secret put <NAME>`)
# Required:
#   DISCORD_CLIENT_SECRET - Discord OAuth client secret
#   JWT_SECRET - Shared secret for signing JWTs (also configure in presets worker)
#
# Generate JWT_SECRET with: openssl rand -hex 32
